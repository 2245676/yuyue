# Project TODO

## 已完成
- [x] 项目追踪网站基础架构
- [x] 全站汉化
- [x] 升级为全栈架构（数据库+认证）

## 待完成
- [x] 修复 Home.tsx 中的 useAuth 导入问题
- [x] 设计桌位管理数据库表结构
- [x] 创建桌位管理数据库迁移
- [x] 开发桌位管理后端 API（增删改查）
- [x] 开发桌位管理前端界面
- [x] 测试桌位管理功能

## 预约管理功能开发
- [x] 设计预约管理数据库表结构
- [x] 创建预约管理数据库迁移
- [x] 开发预约管理后端 API（增删改查）
- [x] 开发日历式预约视图界面
- [x] 开发预约创建表单
- [x] 开发预约编辑功能
- [x] 开发预约删除功能
- [x] 调整导航菜单（移除展示页面）
- [x] 测试预约管理功能

## 移动端优化
- [x] 优化日历视图的移动端布局（单列显示，更大的触摸区域）
- [x] 添加左右滑动手势切换日期
- [x] 优化预约表单的移动端交互（全屏对话框）
- [x] 优化时间选择器的移动端体验
- [x] 测试移动端功能

## 桌位删除功能修复
- [x] 诊断桌位删除功能问题
- [x] 修复桌位删除功能
- [x] 测试桌位删除功能

## 预约视图重构
- [x] 创建系统配置数据表（营业时间、缓冲时间等）
- [x] 开发系统配置管理API
- [x] 重构日历视图布局（桌号左侧，时间上方）
- [x] 实现分钟级时间精度
- [x] 实现预约缓冲时间功能
- [x] 修复表格拖动触发日期切换的bug
- [x] 测试新布局和功能

## UI美化和功能完善
- [x] 修复桌台创建失败问题
- [x] 开发系统配置管理界面
- [x] 添加预约卡片悬浮提示（tooltip）
- [x] 添加双击空白时间槽快速创建预约
- [x] UI美化：顶部日期导航（圆角背景、左右箭头）
- [x] UI美化：标签页切换（タイムスケジュール/リスト）
- [x] UI美化：底部浮动按钮（蓝绿色、圆角、阴影）
- [x] UI美化：底部导航栏（图标+文字）
- [x] UI美化：预约卡片（橙色渐变、圆角、阴影）
- [x] UI美化：非营业时间显示（灰色斜杠背景）
- [x] 响应式适配：大屏横屏
- [x] 响应式适配：大屏竖屏
- [x] 响应式适配：小屏竖屏
- [x] 测试所有功能和UI

## 紧急修复
- [x] 修复生产环境TypeError: t.split is not a function错误
- [x] 修复预约冲突检查逻辑错误
- [x] 添加所有split()调用的类型保护
- [x] 测试修复后的网站访问
- [ ] 重新发布到生产环境

## 错误处理增强
- [x] 添加前端错误边界组件（ErrorBoundary）
- [x] 添加前端详细错误日志（包含堆栈信息）
- [x] 添加后端错误追踪中间件
- [x] 添加用户友好的错误提示
- [ ] 测试错误处理功能

## 桌台创建错误修复
- [ ] 分析后端错误日志并定位问题
- [ ] 修复桌台创建SQL参数错误
- [ ] 测试桌台创建功能

## UI改造 - 全屏预约视图
- [x] 删除左侧边栏
- [x] 添加右上角汉堡菜单（包含预约管理、桌位管理、系统设置）
- [x] 去掉右上角刷新按钮
- [x] 去掉灰色斜线背景
- [x] 调整布局为全屏显示

## 桌台创建修复（全栈）
- [x] 修复桌台创建的桌号输入验证（仅允许数字）
- [x] 统一桌号显示为“号桌”格式
- [x] 后端增加桌号校验逻辑（返回400错误）
- [x] 优化错误提示（不显示原始SQL错误）
- [x] 测试桌号输入和显示

## 库存快速录入功能
- [x] 创建库存数据库schema
- [x] 开发库存后端API（列表、更新）
- [x] 开发库存快速录入页面（手机优先）
- [x] 添加搜索和分类筛选
- [x] 实现自动保存功能
- [x] 添加顶部菜单入口
- [x] 添加底部Tab入口（移动端）
- [x] 测试库存功能

## 时间表视图显示密度优化
- [x] 减小时间列宽度（手机16→12px，桌面20→16px）
- [x] 减小格子高度（手机64→48px，桌面80→64px）
- [x] 减小桌位列最小宽度（手机100→70px，桌面120→90px）
- [x] 优化预约卡片样式（更小的padding和字体）
- [x] 更新getReservationPosition函数使用动态slotHeight
- [x] 确保7个桌位可以完整显示在屏幕上

## 极简桌号列布局实现
- [x] 创建布局配置文件 layoutConfig.ts
- [x] 定义 tableColumnWidth（默认40px）
- [x] 定义 timeSlotWidth（固定64px）
- [x] 定义 rowHeight（响应式：40-48px）
- [x] 修改预约页面使用配置变量
- [x] 替换所有硬编码的宽度和高度值
- [x] 确保桌号列与时间格行高完全一致
- [x] 测试响应式行高逻辑
- [x] 测试桌号列固定不滚动

## 修复桌位创建失败问题
- [x] 检查后端API路由和处理逻辑
- [x] 检查数据库表结构
- [x] 修复创建桌位的bug
- [x] 测试创建功能

## 预约状态显示和字段优化
- [x] 修改数据库 schema 添加 status 字段（NOT_ARRIVED / ARRIVED）
- [x] 修改后端 API 支持状态字段
- [x] 修改首页时间表预约条根据状态显示不同颜色
- [x] 在编辑预约弹窗中添加状态切换按钮
- [x] 在编辑预约弹窗中添加预约日期字段
- [x] 从编辑预约弹窗中删除客户邮箱字段
- [x] 将客户电话改为非必填
- [x] 测试所有修改功能

## 添加当日预约统计面板
- [x] 设计统计面板UI组件
- [x] 实现统计数据计算逻辑（总预约数、已到店数、未到店数）
- [x] 集成到页面顶部
- [x] 测试显示效果

## 时间表视图UI调整
- [x] 移除底部固定操作栏（四个按钮）
- [x] 移除“关闭今日预约”按钮
- [x] 移除相关的 padding-bottom
- [x] 将统计信息从独立卡片区域移入日期横条
- [x] 缩小统计块尺寸，水平居中排列
- [x] 移除“タイムスケジュール / リスト”视图切换标签
- [x] 测试页面布局效果

## 时间轴视觉规范统一
- [x] 实现分级时间刻度线（整点 slate-300/60%，半点 slate-200/40%）
- [x] 优化时间刻度文字样式（text-sm, slate-700, medium）
- [x] 添加当前时间指示线（Now Line，蓝色/40%）
- [x] 确保横向滚动时刻度线与预约块同步，无错位
- [x] 测试桌号列固定、时间轴滚动的稳定性

## 修复侧边栏菜单
- [x] 查找侧边栏组件文件
- [x] 删除“在库（剩余）”菜单项
- [x] 验证修改并截图
- [x] 提供完整的验收证据（文件路径、代码diff、截图）

## 日期选择器功能
- [x] 添加日期选择器组件依赖（Popover + Calendar）
- [x] 添加日期选择器状态管理
- [x] 实现点击日期区域弹出日历
- [x] 实现选择日期后自动跳转
- [x] 测试日期选择功能

## 移动端UI优化 - 统计信息布局
- [x] 分析当前顶部布局结构
- [x] 将统计信息移到标题行内
- [x] 实现响应式flex/grid布局
- [x] 手机端自适应排列并居中
- [x] 桌面端保持原有布局
- [x] 测试不同屏幕尺寸显示效果
